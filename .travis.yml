os: linux
dist: noble
group: dev

service:
  - podman

jobs:
  include:
    - name: "Check Podman Version on Ubuntu Bionic"

before_install:
  - sudo apt-get update

install:
  - sudo sysctl -w kernel.unprivileged_userns_clone=1
  - sudo usermod --add-subuids 100000-165535 $(whoami)
  - sudo usermod --add-subgids 100000-165535 $(whoami)
  - sudo apt-get install -y uidmap slirp4netns fuse-overlayfs

script:
  - podman --version
  - rm -rf ~/.local/share/containers/
  - mkdir -p ~/.config/containers/
  - echo -e "[storage]\ndriver = \"vfs\"" > ~/.config/containers/storage.conf
  - cat ~/.config/containers/storage.conf
  - sudo podman info
  - sudo podman run --rm hello-world
