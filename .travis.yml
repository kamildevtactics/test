jobs:
  include:
    - dist: xenial
      env:
        - TARGET_ENV=stable_xenial
    - dist: xenial
    - group: dev
      env:
        - TARGET_ENV=dev_xenial
    - dist: bionic
      env:
        - TARGET_ENV=stable_bionic
    - dist: bionic
    - group: dev
      env:
        - TARGET_ENV=dev_bionic
    - dist: focal
    - group: dev
      env:
        - TARGET_ENV=dev_focal
    - dist: focal
      env:
        - TARGET_ENV=stable_focal

script:
  - distro=$(lsb_release -c -s)
  - mkdir -p $distro
  - lsb_release -a > $distro/${TARGET_ENV}_ubuntu_version.txt
  - apt list --installed > $distro/${TARGET_ENV}_installed_packages.txt
  - echo "Current environment: $TARGET_ENV"

after_success:
  - git config --global user.name "kamildevtactics"
  - git config --global user.email "kamil.maludzinski@devtactics.net"
  - git clone https://kamildevtactics:$GITHUB_TOKEN@github.com/kamildevtactics/travis_build_test.git
  - cd travis_build_test
  - mkdir -p $distro
  - cp ../$distro/${TARGET_ENV}_ubuntu_version.txt $distro/${TARGET_ENV}_ubuntu_version.txt
  - cp ../$distro/${TARGET_ENV}_installed_packages.txt $distro/${TARGET_ENV}_installed_packages.txt
  - git add $distro/${TARGET_ENV}_ubuntu_version.txt $distro/${TARGET_ENV}_installed_packages.txt
  - git commit -m "Update Ubuntu version and installed packages from Travis CI ($TARGET_ENV)"
  - git push origin main
